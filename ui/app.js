const API_URL = 'https://mohanalavala68.app.n8n.cloud/webhook/events';
const els = { rows:document.getElementById('rows'), sev:document.getElementById('sev'), vendor:document.getElementById('vendor'), type:document.getElementById('type'), status:document.getElementById('status'), refresh:document.getElementById('refresh') };
async function fetchData() { els.status.textContent='Loading live dataâ€¦'; try { const r=await fetch(API_URL); const d=await r.json(); els.status.textContent='Updated: ' + (d.updated_at||new Date().toISOString()); return d.events||[]; } catch(e) { els.status.textContent='Fetch failed. Open: '+API_URL; return []; } }
function passFilters(e){ const s=els.sev.value, v=(els.vendor.value||'').toLowerCase(), t=els.type.value; if(s&&e.severity!==s) return false; if(v && !(e.vendor||'').toLowerCase().includes(v)) return false; if(t&&e.type!==t) return false; return true; }
function row(e){ const tr=document.createElement('tr'); const link=(e.links&&e.links[0])?`<a href="${e.links[0]}" target="_blank">Notes</a>`:''; tr.innerHTML=`<td>${e.vendor||''}</td><td>${e.product||''}</td><td>${e.version||''}</td><td>${e.type||''}</td><td><span class="badge ${e.severity||''}">${e.severity||''}</span></td><td>${(e.published_at||'').slice(0,10)}</td><td>${e.owner?.team||''}</td><td>${link}</td>`; return tr; }
async function draw(){ const items=await fetchData(); els.rows.innerHTML=''; items.filter(passFilters).forEach(e=>els.rows.appendChild(row(e))); }
['change','input'].forEach(ev=>{ els.sev.addEventListener(ev,draw); els.vendor.addEventListener(ev,draw); els.type.addEventListener(ev,draw); }); els.refresh.addEventListener('click',draw); draw();